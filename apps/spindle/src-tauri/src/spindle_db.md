# Spindle Database

## Service

### Table: `service`

| Column  | Type                | Description       |
| ------- | ------------------- | ----------------- |
| id      | INTEGER PRIMARY KEY | Auto-increment PK |
| name    | TEXT NOT NULL       | Service name      |
| version | TEXT NOT NULL       | Service version   |

- **UNIQUE** (name, version)
- No separate `INDEX (name)`; name lookups can use the left prefix of this unique index

### Table: `service_config`

| Column      | Type    | Description                        |
| ----------- | ------- | ---------------------------------- |
| service_id  | INTEGER | Primary key, references service.id |
| program     | TEXT    | Executable path, NOT NULL          |
| description | TEXT    | Description (optional)             |
| workspace   | TEXT    | Working directory (optional)       |

- **PRIMARY KEY** (service_id)
- **CONSTRAINT** fk_service_config_service_id: FOREIGN KEY (service_id) REFERENCES service (id) ON DELETE CASCADE

### Table: `service_arg`

| Column     | Type    | Description                        |
| ---------- | ------- | ---------------------------------- |
| service_id | INTEGER | NOT NULL                           |
| arg_idx    | INTEGER | Argument order (0-based), NOT NULL |
| value      | TEXT    | Argument value, NOT NULL           |

- **PRIMARY KEY** (service_id, arg_idx)
- **CONSTRAINT** fk_service_arg_service_id: FOREIGN KEY (service_id) REFERENCES service (id) ON DELETE CASCADE
- **CHECK** (arg_idx >= 0)

### Table: `service_dependency`

| Column        | Type    | Description |
| ------------- | ------- | ----------- |
| service_id    | INTEGER | NOT NULL    |
| dependency_id | INTEGER | NOT NULL    |

- **PRIMARY KEY** (service_id, dependency_id)
- **CONSTRAINT** fk_service_dependency_service_id: FOREIGN KEY (service_id) REFERENCES service (id) ON DELETE CASCADE
- **CONSTRAINT** fk_service_dependency_dependency_id: FOREIGN KEY (dependency_id) REFERENCES service (id) ON DELETE RESTRICT
- **CHECK** (service_id != dependency_id)
- **INDEX** idx_service_dependency_dependency_id ON (dependency_id), for reverse lookups by dependee

### Table: `service_group_membership`

Group ID is generated by the application layer.

| Column     | Type    | Description |
| ---------- | ------- | ----------- |
| service_id | INTEGER | Primary key |
| group_id   | INTEGER | NOT NULL    |

- **PRIMARY KEY** (service_id)
- **CONSTRAINT** fk_service_group_membership_service_id: FOREIGN KEY (service_id) REFERENCES service (id) ON DELETE CASCADE
- **INDEX** idx_service_group_membership_group_id ON (group_id)

### Table: `service_group_alias`

| Column   | Type    | Description      |
| -------- | ------- | ---------------- |
| group_id | INTEGER | Primary key      |
| alias    | TEXT    | NOT NULL, UNIQUE |

- **PRIMARY KEY** (group_id)
- **UNIQUE** (alias)
